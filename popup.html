<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      * {
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      body {
        padding: 16px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #0b0f14; /* dark */
        color: #e6edf3; /* light text */
        line-height: 1.45;
      }

      .header {
        text-align: center;
        margin-bottom: 16px;
      }

      .title {
        font-size: 16px;
        font-weight: 600;
        color: #e6edf3;
        margin: 0;
        word-wrap: break-word;
      }

      .subtitle {
        font-size: 12px;
        color: #9aa7b2;
        margin: 4px 0 0 0;
        word-wrap: break-word;
      }

      .status {
        background: #0f1624; /* more contrast */
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 14px;
        border: 1px solid #26344a;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        width: 100%;
        max-width: 100%;
      }

      /* Status-based background colors for lead card */
      #leadCard.status-unknown {
        background: rgba(156, 163, 175, 0.25); /* gray - more visible */
        border-color: rgba(156, 163, 175, 0.6);
      }
      #leadCard.status-interested {
        background: rgba(34, 197, 94, 0.25); /* green - more visible */
        border-color: rgba(34, 197, 94, 0.6);
      }
      #leadCard.status-enrolled {
        background: rgba(168, 85, 247, 0.25); /* purple - more visible */
        border-color: rgba(168, 85, 247, 0.6);
      }
      #leadCard.status-ambassador {
        background: rgba(234, 179, 8, 0.25); /* yellow - more visible */
        border-color: rgba(234, 179, 8, 0.6);
      }
      #leadCard.status-uninterested {
        background: rgba(127, 29, 29, 0.25); /* red - more visible */
        border-color: rgba(153, 27, 27, 0.6);
      }

      .status-text {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 6px;
        color: #e6edf3;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .status-details {
        font-size: 13px;
        color: #9aa7b2;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .btn {
        background: #238636; /* green */
        color: #ffffff;
        border: 1px solid #2ea043;
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }

      .btn:hover {
        background: #2ea043;
        border-color: #3fb950;
      }

      .btn:disabled {
        background: #30363d;
        border-color: #30363d;
        color: #8b949e;
        cursor: not-allowed;
      }
      .btn-ghost {
        background: transparent;
        color: #7aa2ff;
        border: 1px dashed #243247;
        padding: 6px 10px;
        font-size: 12px;
      }
      .btn-ghost:hover {
        background: rgba(122, 162, 255, 0.06);
        border-color: #2b3b56;
      }
      .btn-secondary {
        background: #e67e22;
        border-color: #f39c12;
      }
      .btn-secondary:hover {
        background: #f39c12;
        border-color: #f1c40f;
      }
      .btn-primary {
        background: #2ea043;
        border-color: #3fb950;
        box-shadow: 0 6px 18px rgba(63, 185, 80, 0.28);
      }
      .btn-primary:hover {
        background: #3fb950;
        border-color: #58d06f;
      }
      .btn-large {
        padding: 14px 18px;
        font-size: 16px;
        letter-spacing: 0.2px;
      }

      /* Button variants */
      .btn-ghost {
        background: rgba(59, 130, 246, 0.08); /* subtle tint */
        color: #8ab4ff;
        border: 1px dashed #3b82f6;
        padding: 6px 10px;
        font-size: 12px;
      }
      .btn-ghost:hover {
        background: rgba(59, 130, 246, 0.12);
        color: #a6c6ff;
        border-color: #5aa0ff;
      }
      .btn-outline-secondary {
        background: transparent;
        color: #f39c12;
        border: 1px solid #f39c12;
      }
      .btn-outline-secondary:hover {
        background: rgba(243, 156, 18, 0.12);
        border-color: #f1c40f;
        color: #ffd58a;
      }
      .btn-primary {
        background: linear-gradient(135deg, #2ea043 0%, #3fb950 100%);
        border-color: #3fb950;
        box-shadow: 0 6px 16px rgba(63, 185, 80, 0.25);
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #3fb950 0%, #4cc263 100%);
        border-color: #58d06f;
        box-shadow: 0 8px 18px rgba(72, 196, 90, 0.3);
      }
      .btn-large {
        padding: 14px 18px;
        font-size: 16px;
        letter-spacing: 0.2px;
      }
      .btn-small {
        padding: 6px 10px;
        font-size: 12px;
      }
      .section-gap {
        margin-top: 12px;
      }
      textarea,
      input[type="text"],
      input[type="search"] {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #233142;
        background: #0f1624;
        color: #e6edf3;
        font-size: 13px;
        resize: vertical;
        min-height: 60px;
        margin-top: 6px;
        font-family: inherit;
      }
      textarea:focus,
      input[type="text"]:focus,
      input[type="search"]:focus {
        outline: none;
        border-color: #3fb950;
        box-shadow: 0 0 0 2px rgba(63, 185, 80, 0.15);
      }
      input[type="text"].compact {
        min-height: unset;
        height: auto;
      }
      select.compact {
        min-height: unset;
        height: 32px;
      }
      select.compact {
        background: #0f1624;
        color: #e6edf3;
        border: 1px solid #233142;
        border-radius: 8px;
        padding: 4px 8px;
        font-size: 13px;
        cursor: pointer;
      }
      select.compact:focus {
        outline: none;
        border-color: #3fb950;
        box-shadow: 0 0 0 2px rgba(63, 185, 80, 0.15);
      }
      .collapsible {
        width: 100%;
        border: none;
        background: transparent;
        color: #e6edf3;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        padding: 0;
        margin-bottom: 8px;
      }
      .collapsible:hover {
        color: #9fc2ff;
      }
      .collapsible span {
        display: inline-flex;
        align-items: center;
      }
      /* Placeholder toggle - smaller and no wrap */
      #placeholdersToggle {
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 6px;
      }
      #placeholdersToggleText {
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 11px;
        color: #9aa7b2;
      }
      .collapsible-content {
        display: none;
      }
      .collapsible-content.open {
        display: block;
        margin-top: 6px;
      }
      #kbToggleIcon,
      #scriptsToggleIcon,
      #placeholdersToggleIcon {
        font-size: 12px;
        transition: transform 0.15s ease;
      }
      #kbToggleIcon.open,
      #scriptsToggleIcon.open,
      #placeholdersToggleIcon.open {
        transform: rotate(90deg);
      }
      .kb-field {
        margin-top: 10px;
      }

      .info {
        background: #0d3b66;
        border-radius: 8px;
        padding: 10px;
        margin-top: 12px;
        font-size: 12px;
        color: #cfe8ff;
        word-wrap: break-word;
        overflow-wrap: break-word;
        border: 1px solid #184a7a;
      }

      /* Console panel tweaks */
      #consolePanel {
        background: #0c1d2c; /* deeper blue for contrast */
        border: 1px solid #274363;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
      }
      #consoleList {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        color: #c9d1d9;
      }
    </style>
  </head>
  <body>
    <!-- Lead container at the top -->
    <div class="status status-unknown" id="leadCard">
      <div class="status-text" id="leadName">Lead: —</div>
      <div class="status-details" id="leadDescription">No recent activity.</div>
      <div class="status-details" id="leadData" style="margin-top: 6px"></div>
      
      <!-- Status Section - Compact -->
      <div style="margin-top: 8px;">
        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
          <span class="status-details" style="font-weight: 600; color: #9aa7b2; font-size: 12px;">Status:</span>
          <select id="leadStatusSelect" class="compact" style="flex: 1; min-width: 100px;">
            <option value="unknown">Unknown</option>
            <option value="uninterested">Uninterested</option>
            <option value="interested">Interested</option>
            <option value="enrolled">Enrolled</option>
            <option value="ambassador">Ambassador</option>
          </select>
          <button id="updateStatusBtn" class="btn btn-ghost btn-small" style="font-size: 11px; padding: 4px 8px;">
            Update
          </button>
        </div>
      </div>
    </div>

    <!-- Placeholders Section - Collapsible -->
    <div class="status" id="placeholdersPanel" style="margin-top: 10px">
      <button class="collapsible" id="placeholdersToggle">
        <span id="placeholdersToggleIcon">▶</span>
        <span id="placeholdersToggleText">Placeholders</span>
      </button>
      <div id="placeholdersContent" class="collapsible-content">
        <div class="status-details" style="margin-bottom: 8px; font-size: 11px; color: #9aa7b2;">
          Edit placeholder values used in script templates.
        </div>
        <div style="display: flex; flex-direction: column; gap: 6px;">
          <div>
            <label class="status-details" style="font-size: 11px; color: #9aa7b2; display: block; margin-bottom: 3px;">Name</label>
            <input type="text" id="placeholderName" class="compact" placeholder="Name" style="width: 100%; font-size: 12px; padding: 5px 8px; height: 28px;" />
          </div>
          <div>
            <label class="status-details" style="font-size: 11px; color: #9aa7b2; display: block; margin-bottom: 3px;">School</label>
            <input type="text" id="placeholderSchool" class="compact" placeholder="School" style="width: 100%; font-size: 12px; padding: 5px 8px; height: 28px;" />
          </div>
          <div>
            <label class="status-details" style="font-size: 11px; color: #9aa7b2; display: block; margin-bottom: 3px;">Idea/Vision</label>
            <input type="text" id="placeholderIdea" class="compact" placeholder="Idea/Vision" style="width: 100%; font-size: 12px; padding: 5px 8px; height: 28px;" />
          </div>
          <button id="updatePlaceholdersBtn" class="btn btn-ghost btn-small" style="margin-top: 4px; font-size: 11px; padding: 6px 10px;">
            Save Placeholders
          </button>
        </div>
      </div>
    </div>

    <!-- Extract DOM and Update Cloud buttons -->
    <div style="display: flex; gap: 8px; margin-top: 10px">
      <button class="btn btn-ghost" id="extractBtn" style="flex: 1">
        Extract DOM
      </button>
      <button
        class="btn btn-outline-secondary btn-small"
        id="updateCloudBtn"
        style="flex: 1"
      >
        Update Cloud
      </button>
    </div>

    <!-- Suggested container (status area with message and phase) -->
    <div class="status" style="margin-top: 10px">
      <div class="status-text" style="display: flex; align-items: center; justify-content: space-between">
        <span id="statusText">Ready</span>
        <div style="display: flex; align-items: center; gap: 4px">
          <button
            id="prevRespBtn"
            class="btn btn-ghost btn-small"
            style="min-width: 28px; padding: 2px 4px; font-size: 10px"
            disabled
          >
            ◀
          </button>
          <div
            id="respCounter"
            class="status-details"
            style="min-width: 32px; text-align: center; font-size: 10px; color: #9aa7b2"
          >
            0/0
          </div>
          <button
            id="nextRespBtn"
            class="btn btn-ghost btn-small"
            style="min-width: 28px; padding: 2px 4px; font-size: 10px"
            disabled
          >
            ▶
          </button>
        </div>
      </div>
      <div class="status-details" id="statusDetails">
        Click to extract current page DOM
      </div>
      <div class="status-details" id="statusPhase" style="margin-top: 8px; padding: 6px 10px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.3); display: none;">
        <strong style="color: #8ab4ff;">Phase:</strong> <span id="phaseValue">—</span>
      </div>
    </div>

    <!-- Prominent generate button used most often -->
    <button
      class="btn btn-primary btn-large"
      id="generateResponseBtn"
      style="margin-top: 2px"
      aria-label="Generate suggested response from Supabase data"
      title="Fetch latest conversation from cloud and generate a response"
    >
      Generate Response
    </button>

    <div class="status" id="scriptsPanel" style="margin-top: 12px">
      <button class="collapsible" id="scriptsToggle">
        <span id="scriptsToggleIcon">▶</span>
        <span>Script Templates</span>
      </button>
      <div id="scriptsContent" class="collapsible-content">
        <div class="status-details" id="scriptsStatusMessage" style="margin-bottom: 10px">
          Click a button to insert the script into the message input.
        </div>
        <div id="scriptsContainer">
          <div class="status-details" style="color: #9aa7b2">Loading scripts...</div>
        </div>
      </div>
    </div>

    <div class="status" id="kbPanel" style="margin-top: 12px">
      <button class="collapsible" id="kbToggle">
        <span id="kbToggleIcon">▶</span>
        <span>Knowledge Base</span>
      </button>
      <div id="kbContent" class="collapsible-content">
        <div class="status-details" id="kbStatusMessage">
          Save answers for future conversations. Only you can trigger this action manually.
        </div>
        <div class="kb-field">
          <label class="status-details kb-label">
            Question (optional)
          </label>
          <textarea id="kbQuestionInput" placeholder="What question did the student ask?"></textarea>
        </div>
        <div class="kb-field">
          <label class="status-details kb-label">
            Answer / Context to reuse
          </label>
          <textarea id="kbAnswerInput" placeholder="Write the answer you want the AI to reuse" required></textarea>
        </div>
        <div class="kb-field">
          <label class="status-details kb-label">
            Tags (comma separated, optional)
          </label>
          <input
            type="text"
            id="kbTagsInput"
            class="compact"
            placeholder="e.g. price, timeline, prodicity"
          />
        </div>
        <div class="kb-field">
          <label class="status-details kb-label">
            Source / Note (optional)
          </label>
          <input
            type="text"
            id="kbSourceInput"
            class="compact"
            placeholder="e.g. manual-entry, conversation-<thread>"
          />
        </div>
        <button class="btn btn-secondary" id="saveKbBtn" style="margin-top:12px">
          Save to Knowledge Base
        </button>
      </div>
    </div>

    <div class="status" id="consolePanel" style="margin-top: 14px">
      <div class="status-text">Console</div>
      <div class="status-details" style="color: #9fc2ff">Live logs</div>
      <div
        class="status-details"
        id="consoleList"
        style="
          max-height: 200px;
          overflow-y: auto;
          white-space: pre-wrap;
          background: rgba(0, 0, 0, 0.15);
          border-radius: 8px;
          padding: 8px;
          border: 1px solid rgba(255, 255, 255, 0.04);
        "
      ></div>
    </div>

    <!-- Supabase Config -->
    <script src="supabase-config.js"></script>
    <script src="supabase-service.js"></script>
    <script src="ai-service.js"></script>

    <!-- Main App -->
    <script src="popup.js"></script>
  </body>
</html>

